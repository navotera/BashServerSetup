- name: "install Modsecurity 2 latest version"
  hosts: localhost
  connection: local 
  tasks:
  - name: Install prerequisites
    apt: name={{ item }} update_cache=yes state=latest force_apt_get=yes
    loop: [ 'aptitude' ]

  - name: Install Apache
    apt: name=apache2 update_cache=yes state=latest
    state: present

  - name: "Clone the mod "
    shell: |
      cd /tmp/
      git clone https://github.com/SpiderLabs/ModSecurity.git
      cd Modsecurity
      ./build.sh
      git submodule init 
      git submodule update 

  - name: Make install 
    shell : ./configure && make && make install 
    register: make_install
    retries: 10
    until: make_install is success
    debugger: on_failed
    async: 1800
    poll: 10

  - name: copy the mod_security2.so to apache2 folder 
    shell : |
      makedir -p /etc/apache2/modsecurity.d
      cp /usr/local/modsecurity/lib/mod_security2.so /etc/apache2/modsecurity.d/

